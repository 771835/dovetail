# 进阶

## 三目运算符

dovetail语言中的三目运算符支持传统风格与python风格

```dovetail
func main() {
    print("Hello" + "Alex" if true else "Steve")
}
```

```dovetail
func main() {
    print("Hello" +  true ? "Alex" : "Steve")
}
```

## 函数

在dovetail语言中中有诸多函数，这些函数分为`内置函数`与`普通函数`**(以下函数均指dovetail语言定义的函数而非`mcfunction`
的函数)**

### 内置函数

内置函数由标准库实现或由后端实现，如`print`函数就是内置函数，`print`实际会调用tellraw_text函数
具体函数列表见[dfp-300 内置函数](../../proposals/DFP-300.md)和[dfp-301 后端内置函数](../../proposals/DFP-301.md)

### 普通函数

使用`func`或`method`关键字定义的函数为普通函数

## 标记

标记用于函数定义，可通过标记使编译器确定哪些函数将在编译后生成指令和调用，例如`init`和`tick`标记

```dovetail
@init
func main() {
    print("Hello Minecraft")
}
```

## 类

在dovetail语言中，类是一种用户自定义的数据结构，用于封装数据和相关的操作方法。

### 定义

使用`class`关键字定义类，类体内可以包含字段声明和方法定义：

```dovetail
class 类名 {
    // 字段声明
    类型 字段名;
    
    // 方法定义
    method 方法名(参数列表) -> 返回类型 {
        // 方法体
    }
}
```

### 构造函数

每个类都应该有一个构造函数`__init__`，用于初始化对象的字段。在dovetail中，方法的第一个参数是对象自身的引用，构造函数不返回任何值：

```dovetail
class Student {
    string name;
    int age;

    method __init__(Student self, string name, int age){
        self.name = name;
        self.age = age;
    }
}
```

### 对象的创建与使用

通过类名后跟圆括号来创建对象实例：

```dovetail
func main() {
    // 创建对象
    Student student = Student("Alice",18);
    
    // 访问字段
    print(student.name);  // 输出: Alice
    
    // 修改字段
    student.age = 20;
    print(str(student.age));  // 输出: 20
}
```

### 方法调用

除了构造函数，类还可以定义其他方法，方法的第一个参数始终是对象自身的引用：

```dovetail

class Calculator {
    int result;

    method __init__(Calculator self){
        self.result = 0;
    }

    method add(Calculator self, int value){
        self.result = self.result + value;
    }

    method get_result(Calculator self) -> int {
        return self.result;
    }
}

@init
func main() {
    Calculator calc = Calculator();
    calc.add(calc, 10);
    calc.add(calc, 5);
    print(str(calc.get_result(calc)));  // 输出: 15
}

```

### 类的特性

- **封装性**：字段和方法被封装在类中
- **引用语义**：对象变量存储的是对象的引用，而非对象本身
- **显式`self`参数**：所有方法都需要显式声明第一个参数作为对象自身的引用
- **构造函数不返回对象**：`__init__`构造函数不返回，对象创建由运行时自动处理
- **方法名唯一性**：不支持方法重载，每个方法名在类中必须唯一
- **方法调用**：通过对象实例调用其方法时需要传入对象自身作为第一个参数

### 重要注意事项

- **无递归支持**：`dovetail`语言不支持递归特性，因此类之间的循环调用将会导致严重问题且难以在编译时检查
- **未初始化字段风险**：使用未赋值的字段将导致未定义行为，存在巨大风险，使用前必须确保字段已被正确初始化
- **引用赋值语义**：对象实例赋值采用传引用方式，如`a = b`会使`a`和`b`指向同一实例，修改其中一个会影响另一个