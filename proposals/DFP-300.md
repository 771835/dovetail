# DFP 300: 内置函数

## 状态

- [ ] Draft
- [ ] Proposed
- [ ] Accepted
- [ ] Rejected
- [ ] Deferred
- [ ] Implemented (版本: )
- [x] Active
- [ ] Abandoned (版本: )

## 作者

- 771835 <2790834181@qq.com>

## 创建日期

- 2025-07-20

## 摘要

本提案规定了Dovetail语言标准库的内置函数集合，包含基础类型转换、调试工具、数学运算和断言机制。这些函数通过IR指令直接映射到底层虚拟机操作，确保执行效率和语言一致性。

## 动机

1. **开发效率**：提供常用功能无需开发者重复实现
2. **语言完整性**：补全基础类型操作和调试支持
3. **性能优化**：通过IR指令直译避免中间层开销
4. **规范统一**：建立标准化的函数命名和行为准则

## 技术规范

### 1. 类型转换函数

| 函数签名                      | 功能描述      | 特殊行为         |
|---------------------------|-----------|--------------|
| `int(value: int): string` | 将整数转换为字符串 | -            |
| `str(value: string): int` | 将字符串转换为整数 | 输入数据异常时，无法检测 |

### 2. 实用函数

| 函数签名                           | 功能描述    | 
|--------------------------------|---------|
| `type_of(value: any): string`  | 返回类型的名称 |
| `swap(a: any, b: any): string` | 交换a和b的值 |

### 3. 字符串处理函数

| 函数签名                                        | 功能描述  | 
|---------------------------------------------|-------|
| `print(msg: string): void`                  | 输出字符串 |
| `strcat(dest: string, src: string): string` | 拼接字符串 |

### 4. 数学函数

| 函数签名                       | 功能描述   | 特殊行为      | 
|----------------------------|--------|-----------|
| `abs(x: int): void`        | 返回绝对值  | 最小负数返回本身  |
| `min(a: int, b: int): int` | 返回较小值	 | 相等时返回任意一个 |
| `max(a: int, b: int): int` | 返回较大值	 | 相等时返回任意一个 |

### 5. 特殊函数

| 函数签名                          | 功能描述              | 特殊行为        | 
|-------------------------------|-------------------|-------------|
| `exec(command: string): void` | 执行给定命令            | 命令错误不进行执行   |
| `_call(scope: string): void`  | 插入一个跳转指令，跳转到给定作用域 | 找不到所给作用域时报错 |
| ...                           | 其他原版指令的函数调用形式     | -           |

<!-- _call函数存在风险，不应该作为递归的替代品。  -->

## 参考实现

无

## 变更日志

- 2025-07-20 初步规范标准库函数表 