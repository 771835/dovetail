# DFP 601: 日志输出规范

## 提案信息

**作者**: 771835 <2790834181@qq.com>  
**状态**: Implemented  
**创建日期**: 2026-02-02  
**最新更新**: 2026-02-02

## 设计目标

本提案旨在统一 Dovetail 编译器的日志输出形式，规定输出日志的场景和格式，提高日志的可读性和可维护性。
通过引入结构化日志系统，区分不同级别的日志信息，为开发者和用户提供清晰、一致的运行时反馈。

## 动机

### 问题背景

1. 代码中直接使用 print() 输出，缺乏统一的日志接口。
2. 难以区分调试信息、普通信息、警告和错误，所有内容以相同方式输出。
3. 日志缺少时间戳、模块名等上下文，排查问题时难以定位来源。
4. 编译各阶段的性能统计缺乏统一格式，混在普通输出中。

## 技术规范

1. 日志级别
   采用标准五级日志系统：

   | 级别        | 用途          | 示例场景        |
                                                   |-----------|-------------|-------------|
   | DEBUG     | 	详细的调试信息	IR | 指令详情、作用域结构  |
   | INFO	     | 一般信息性消息	    | 编译阶段开始/完成   |
   | WARNING   | 	警告信息	      | 类型自动转换、弃用特性 |
   | ERROR     | 	错误信息，编译失败  | 	语法错误、类型不匹配 |
   | CRITICAL	 | 严重错误，系统级故障	 | 内存不足、插件加载失败 |

2. 日志格式
   标准输出格式：

    ```
    YYYY-MM-DD HH:MM:SS - [module] - [LEVEL] - 消息内容
    ```

3. 系统设计

   #### 核心组件：

    - 创建统一的日志管理器模块 transpiler/utils/logger.py
    - 基于 Python 标准库 logging 实现
    - 支持通过配置控制日志级别和输出格式
   #### 使用方式：

    - 替换大多数 print 为日志调用
    - 在命令行参数中提供 --log-level 选项

4. print 与 logger 的适用范围
   以下场景**必须**使用日志系统：
    1. 编译流程信息
        - 各阶段的**开始/完成**状态
        - 后端选择、插件加载等系统决策
    2. 性能统计
        - 所有阶段的耗时统计
    3. 警告信息
        - 类型自动转换、隐式行为
        - 弃用特性使用
    4. 错误信息
        - 编译错误（配合异常系统）
        - 配置错误、文件未找到等

   print() **允许**保留场景：
    1. 格式化数据结构展示
        - 当使用 --debug 时输出的复杂结构（如 IR 树、作用域树）
        - 这些输出需要保持特定的缩进和格式，不适合日志前缀

## 变更日志

2026-02-02：初始提案创建
